{"metadata":{"images":[{"type":"card","identifier":"host-server-card.jpg"}],"modules":[{"name":"VernissageServer"}],"role":"article","roleHeading":"Article","title":"Host Vernissage API"},"kind":"article","variants":[{"paths":["\/documentation\/vernissageserver\/hostvernissageserver"],"traits":[{"interfaceLanguage":"swift"}]}],"abstract":[{"type":"text","text":"Application which is main API component for Vernissage photos sharing platform."}],"primaryContentSections":[{"content":[{"text":"Overview","anchor":"Overview","type":"heading","level":2},{"type":"paragraph","inlineContent":[{"text":"Vernissage API server is created in ","type":"text"},{"identifier":"https:\/\/www.swift.org\/","isActive":true,"type":"reference"},{"type":"text","text":" language with "},{"identifier":"https:\/\/vapor.codes","isActive":true,"type":"reference"},{"type":"text","text":" framework."},{"type":"text","text":" "},{"type":"text","text":"We can run it in all operating systems supporting "},{"code":"Swift","type":"codeVoice"},{"text":" and ","type":"text"},{"type":"codeVoice","code":"Vapor"},{"type":"text","text":"."}]},{"text":"Prerequisites","anchor":"Prerequisites","level":2,"type":"heading"},{"inlineContent":[{"text":"Install the ","type":"text"},{"code":"GD","type":"codeVoice"},{"text":" library on your computer. If you’re using macOS, install Homebrew then run the command ","type":"text"},{"code":"brew install gd","type":"codeVoice"},{"text":".","type":"text"},{"text":" ","type":"text"},{"text":"If you’re using Linux, run ","type":"text"},{"code":"apt-get libgd-dev","type":"codeVoice"},{"type":"text","text":" as root."}],"type":"paragraph"},{"level":2,"text":"Architecture","anchor":"Architecture","type":"heading"},{"syntax":null,"type":"codeListing","code":["    +------------- +                           +------------- +","    |   Client A   |-------------+-------------|   Client B   |","    +--------------+             |             +------------- +","                                 |","                                 |","                   +-----------------------------+","                   |   VernissageAPI (Swift)     |","                   +-------------+---------------+","                                 |","             +-------------------+-------------------+","             |                   |                   |","    +--------+--------+   +------+------+   +--------+-----------+","    |   PostgreSQL    |   |    Redis    |   |  ObjectStorage S3  |","    +-----------------+   +-------------+   +--------------------+"]},{"text":"Getting started","type":"heading","anchor":"Getting-started","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"After clonning the reposity you can easly run the API. Go to main repository folder and run the command:"}]},{"type":"codeListing","syntax":"bash","code":["$ swift run"]},{"inlineContent":[{"type":"text","text":"API should start. Configuration will be read from "},{"code":"appsettings.json","type":"codeVoice"},{"type":"text","text":" file. SQLite database will be used. You can sign in using default "},{"type":"codeVoice","code":"admin"},{"type":"text","text":" account (with password: "},{"type":"codeVoice","code":"admin"},{"text":"). For example:","type":"text"}],"type":"paragraph"},{"syntax":"bash","code":["$ curl --location 'http:\/\/localhost:8080\/api\/v1\/account\/login' \\","--header 'Accept: application\/json' \\","--header 'Content-Type: application\/json' \\","--data-raw '{","    \"userNameOrEmail\": \"admin\",","    \"password\": \"admin\"","}'"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Request will return JSON:"}]},{"syntax":"json","code":["{","    \"accessToken\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJpZCI6IjcyNTA3Mjk3NzcyNjEyMzYyMjUiLCJhcHBsaWNhdGlvbiI6IlZlcm5pc3NhZ2UgMS4wLjAtYWxwaGExIiwicm9sZXMiOlsiYWRtaW5pc3RyYXRvciJdLCJ1c2VyTmFtZSI6ImFkbWluIiwibmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6ImFkbWluQGxvY2FsaG9zdCIsImV4cCI6MTcwNjE2OTE1Mi4zODk5NTMxfQ.Z87v9HvfBM6fn6F8fu06ToPShT9F55G74wL676SLmSdLMzyz3ykfsmS-GDNIqfUatfwdBvSxQgpjUO6IzYAuQKZ925tdN8DwN6kVAEa2mJLlntc66qAkQSiPeXYEl29Cgbg6TuAvxghWVO5PVliMG8mxO7uwSFDN095mNxbee8x8P-ogL176vXBhJ_rWcm1fY7_n-qSn6XN2GbgjiywnOZfvHNNtLvbikcpJeIAzHH-BlXolWsUauuZGZBeFv5TuBr13r5PZfVar0FH9Uwj39w5DV3jxlwRPyejux4LL96dvrEsP4Btx88c3SSLyxm1REfRR_wKoUoXK8iVqfBU6TQ\",","    \"refreshToken\": \"U8zMqw1tGHqIk0cUXmvAEcwYIpsQlwWUxHa0fnXbu\"","}"],"type":"codeListing"},{"inlineContent":[{"type":"text","text":"After successfully sign in you can use other endpoints (with "},{"code":"Authentication: Bearer","type":"codeVoice"},{"type":"text","text":" header)."}],"type":"paragraph"},{"level":2,"type":"heading","text":"Custom configuration","anchor":"Custom-configuration"},{"inlineContent":[{"type":"text","text":"In local development environment you can create "},{"type":"codeVoice","code":"appsettings.local.json"},{"type":"text","text":" file (near "},{"type":"codeVoice","code":"appsettings.json"},{"type":"text","text":" file). This file can look like that:"}],"type":"paragraph"},{"type":"codeListing","code":["{","    \"vernissage\": {","        \"baseAddress\": \"http:\/\/localhost:8080\",","        \"connectionString\": \"postgres:\/\/postgres:secretpass@localhost:5432\/postgres\",","        \"queueUrl\": \"redis:\/\/127.0.0.1:6379\",","        \"s3Address\": \"https:\/\/s3.eu-central-1.amazonaws.com\",","        \"s3Region\": \"eu-central-1\",","        \"s3Bucket\": \"your-bucket-test\",","        \"s3AccessKeyId\": \"ASDA8AS8HSDSU\",","        \"s3SecretAccessKey\": \"DSfEaBUYIhoouHhigygGtldDpLesmXCz10ICe0F\"","    }","}"],"syntax":"json"},{"inlineContent":[{"type":"text","text":"Here you can configure three external resources:"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"type":"codeVoice","code":"connectionString"},{"type":"text","text":" - you can use SQLite or Postgres database connection string"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"queueUrl"},{"type":"text","text":" - URL to Redis in memory data store (used as cache and queue by Vernissage)"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"s3*","type":"codeVoice"},{"type":"text","text":" - configuration of S3 storage. Here you can use any external S3 compatible cloud storage or "},{"type":"reference","identifier":"https:\/\/min.io","isActive":true},{"text":" docker (","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/hub.docker.com\/r\/minio\/minio"},{"text":")","type":"text"}]}]}]},{"type":"paragraph","inlineContent":[{"text":"In production environment you can override configuration parameters by environment variables. For example if you want to set custom ","type":"text"},{"type":"codeVoice","code":"baseAddress"},{"type":"text","text":" you have to define variable: "},{"type":"codeVoice","code":"VERNISSAGE_BASEADDRESS"},{"type":"text","text":", etc."}]},{"anchor":"Docker","level":2,"type":"heading","text":"Docker"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In production environments, it is best to use a "},{"identifier":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server","type":"reference","isActive":true},{"type":"text","text":"."}]}],"kind":"content"}],"schemaVersion":{"minor":3,"patch":0,"major":0},"identifier":{"url":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageServer","interfaceLanguage":"swift"},"sections":[],"seeAlsoSections":[{"generated":true,"identifiers":["doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageWeb","doc:\/\/VernissageServer\/documentation\/VernissageServer\/BuildDocumentation"],"title":"Essentials"}],"hierarchy":{"paths":[["doc:\/\/VernissageServer\/documentation\/VernissageServer"]]},"references":{"https://vapor.codes":{"title":"Vapor","identifier":"https:\/\/vapor.codes","titleInlineContent":[{"text":"Vapor","type":"text"}],"type":"link","url":"https:\/\/vapor.codes"},"https://www.swift.org/":{"title":"Swift","type":"link","identifier":"https:\/\/www.swift.org\/","titleInlineContent":[{"text":"Swift","type":"text"}],"url":"https:\/\/www.swift.org\/"},"https://min.io":{"title":"minio","identifier":"https:\/\/min.io","titleInlineContent":[{"text":"minio","type":"text"}],"type":"link","url":"https:\/\/min.io"},"doc://VernissageServer/documentation/VernissageServer":{"title":"VernissageServer","type":"topic","url":"\/documentation\/vernissageserver","role":"collection","abstract":[{"type":"text","text":"Application which is main API component for Vernissage photos sharing platform."}],"identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer","kind":"symbol"},"doc://VernissageServer/documentation/VernissageServer/HostVernissageWeb":{"images":[{"identifier":"host-web-card.jpg","type":"card"}],"abstract":[{"type":"text","text":"Application which is Web component for Vernissage photos sharing platform."}],"identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageWeb","type":"topic","url":"\/documentation\/vernissageserver\/hostvernissageweb","title":"Host Vernissage WEB","kind":"article","role":"article"},"doc://VernissageServer/documentation/VernissageServer/BuildDocumentation":{"abstract":[{"type":"text","text":"This documentation is created by DocC tool."}],"role":"article","url":"\/documentation\/vernissageserver\/builddocumentation","type":"topic","title":"Build the documentation","identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/BuildDocumentation","kind":"article"},"host-server-card.jpg":{"alt":null,"type":"image","identifier":"host-server-card.jpg","variants":[{"url":"\/images\/host-server-card@2x.jpg","traits":["2x","light"]}]},"host-web-card.jpg":{"identifier":"host-web-card.jpg","alt":"The profile image for web documentation.","type":"image","variants":[{"url":"\/images\/host-web-card@2x.jpg","traits":["2x","light"]}]},"https://hub.docker.com/r/minio/minio":{"identifier":"https:\/\/hub.docker.com\/r\/minio\/minio","type":"link","title":"https:\/\/hub.docker.com\/r\/minio\/minio","titleInlineContent":[{"type":"text","text":"https:\/\/hub.docker.com\/r\/minio\/minio"}],"url":"https:\/\/hub.docker.com\/r\/minio\/minio"},"https://hub.docker.com/repository/docker/mczachurski/vernissage-server":{"title":"docker image","identifier":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server","titleInlineContent":[{"type":"text","text":"docker image"}],"type":"link","url":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server"}}}