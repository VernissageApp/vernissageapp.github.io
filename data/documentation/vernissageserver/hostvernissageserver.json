{"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageServer"},"schemaVersion":{"patch":0,"minor":3,"major":0},"abstract":[{"text":"Application which is main API component for Vernissage photos sharing platform.","type":"text"}],"sections":[],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/vernissageserver\/hostvernissageserver"]}],"hierarchy":{"paths":[["doc:\/\/VernissageServer\/documentation\/VernissageServer"]]},"kind":"article","seeAlsoSections":[{"generated":true,"identifiers":["doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageWeb","doc:\/\/VernissageServer\/documentation\/VernissageServer\/BuildDocumentation"],"title":"Essentials"}],"primaryContentSections":[{"content":[{"anchor":"Overview","type":"heading","text":"Overview","level":2},{"type":"paragraph","inlineContent":[{"text":"Vernissage API server is created in ","type":"text"},{"isActive":true,"type":"reference","identifier":"https:\/\/www.swift.org\/"},{"type":"text","text":" language with "},{"type":"reference","isActive":true,"identifier":"https:\/\/vapor.codes"},{"type":"text","text":" framework."},{"type":"text","text":" "},{"text":"We can run it in all operating systems supporting ","type":"text"},{"code":"Swift","type":"codeVoice"},{"type":"text","text":" and "},{"code":"Vapor","type":"codeVoice"},{"type":"text","text":"."}]},{"level":2,"anchor":"Prerequisites","text":"Prerequisites","type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Install the ","type":"text"},{"type":"codeVoice","code":"GD"},{"type":"text","text":" library on your computer. If you’re using macOS, install Homebrew then run the command "},{"code":"brew install gd","type":"codeVoice"},{"text":".","type":"text"},{"type":"text","text":" "},{"type":"text","text":"If you’re using Linux, run "},{"code":"apt-get libgd-dev","type":"codeVoice"},{"text":" as root.","type":"text"}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"Running the application requires installing "},{"isActive":true,"identifier":"https:\/\/www.swift.org\/install\/","type":"reference"},{"type":"text","text":"."}]},{"level":2,"anchor":"Getting-started","type":"heading","text":"Getting started"},{"inlineContent":[{"text":"Below are all the commands necessary to run the API part of the Vernissage.","type":"text"}],"type":"paragraph"},{"syntax":"bash","code":["$ git clone https:\/\/github.com\/VernissageApp\/VernissageServer.git","$ cd VernissageServer","$ swift run"],"type":"codeListing"},{"inlineContent":[{"text":"API should start. Configuration will be read from ","type":"text"},{"type":"codeVoice","code":"appsettings.json"},{"text":" file. SQLite database will be used. You can sign in using default ","type":"text"},{"type":"codeVoice","code":"admin"},{"text":" account (with password: ","type":"text"},{"code":"admin","type":"codeVoice"},{"type":"text","text":"). For example:"}],"type":"paragraph"},{"syntax":"bash","code":["$ curl --location 'http:\/\/localhost:8080\/api\/v1\/account\/login' \\","--header 'Accept: application\/json' \\","--header 'Content-Type: application\/json' \\","--data-raw '{","    \"userNameOrEmail\": \"admin\",","    \"password\": \"admin\"","}'"],"type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Request will return JSON:"}]},{"code":["{","    \"accessToken\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJpZCI6IjcyNTA3Mjk3NzcyNjEyMzYyMjUiLCJhcHBsaWNhdGlvbiI6IlZlcm5pc3NhZ2UgMS4wLjAtYWxwaGExIiwicm9sZXMiOlsiYWRtaW5pc3RyYXRvciJdLCJ1c2VyTmFtZSI6ImFkbWluIiwibmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6ImFkbWluQGxvY2FsaG9zdCIsImV4cCI6MTcwNjE2OTE1Mi4zODk5NTMxfQ.Z87v9HvfBM6fn6F8fu06ToPShT9F55G74wL676SLmSdLMzyz3ykfsmS-GDNIqfUatfwdBvSxQgpjUO6IzYAuQKZ925tdN8DwN6kVAEa2mJLlntc66qAkQSiPeXYEl29Cgbg6TuAvxghWVO5PVliMG8mxO7uwSFDN095mNxbee8x8P-ogL176vXBhJ_rWcm1fY7_n-qSn6XN2GbgjiywnOZfvHNNtLvbikcpJeIAzHH-BlXolWsUauuZGZBeFv5TuBr13r5PZfVar0FH9Uwj39w5DV3jxlwRPyejux4LL96dvrEsP4Btx88c3SSLyxm1REfRR_wKoUoXK8iVqfBU6TQ\",","    \"refreshToken\": \"U8zMqw1tGHqIk0cUXmvAEcwYIpsQlwWUxHa0fnXbu\"","}"],"syntax":"json","type":"codeListing"},{"type":"paragraph","inlineContent":[{"type":"text","text":"After successfully sign in you can use other endpoints (with "},{"type":"codeVoice","code":"Authentication: Bearer"},{"text":" header).","type":"text"}]},{"type":"heading","text":"Custom configuration","anchor":"Custom-configuration","level":2},{"type":"paragraph","inlineContent":[{"type":"text","text":"In local development environment you can create "},{"type":"codeVoice","code":"appsettings.local.json"},{"text":" file (near ","type":"text"},{"type":"codeVoice","code":"appsettings.json"},{"type":"text","text":" file). This file can look like that:"}]},{"syntax":"json","type":"codeListing","code":["{","    \"vernissage\": {","        \"baseAddress\": \"http:\/\/localhost:8080\",","        \"connectionString\": \"postgres:\/\/postgres:secretpass@localhost:5432\/postgres\",","        \"queueUrl\": \"redis:\/\/127.0.0.1:6379\",","        \"s3Address\": \"https:\/\/s3.eu-central-1.amazonaws.com\",","        \"s3Region\": \"eu-central-1\",","        \"s3Bucket\": \"your-bucket-test\",","        \"s3AccessKeyId\": \"ASDA8AS8HSDSU\",","        \"s3SecretAccessKey\": \"DSfEaBUYIhoouHhigygGtldDpLesmXCz10ICe0F\"","    }","}"]},{"inlineContent":[{"text":"Here you can configure three external resources:","type":"text"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"connectionString"},{"type":"text","text":" - you can use SQLite or Postgres database connection string"}]}]},{"content":[{"inlineContent":[{"type":"codeVoice","code":"queueUrl"},{"type":"text","text":" - URL to Redis in memory data store (used as cache and queue by Vernissage)"}],"type":"paragraph"}]},{"content":[{"type":"paragraph","inlineContent":[{"code":"s3*","type":"codeVoice"},{"type":"text","text":" - configuration of S3 storage. Here you can use any external S3 compatible cloud storage or "},{"type":"reference","identifier":"https:\/\/min.io","isActive":true},{"type":"text","text":" docker ("},{"type":"reference","identifier":"https:\/\/hub.docker.com\/r\/minio\/minio","isActive":true},{"type":"text","text":")"}]}]}],"type":"unorderedList"},{"style":"note","name":"Note","content":[{"inlineContent":[{"type":"text","text":"If the "},{"type":"codeVoice","code":"s3Region"},{"type":"text","text":" variable is set, it causes the other settings to be overwritten and use Amazon AWS S3."}],"type":"paragraph"}],"type":"aside"},{"inlineContent":[{"type":"text","text":"In production environment you can override configuration parameters by environment variables. For example if you want to set custom "},{"type":"codeVoice","code":"baseAddress"},{"text":" you have to define variable: ","type":"text"},{"type":"codeVoice","code":"VERNISSAGE_BASEADDRESS"},{"type":"text","text":", etc."}],"type":"paragraph"},{"anchor":"File-logger","type":"heading","text":"File logger","level":2},{"inlineContent":[{"text":"By default, the system displays logs only on the system console. If logging is also to be done to a file we need to set a system environment variable:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"inlineContent":[{"code":"VERNISSAGE_LOG_PATH","type":"codeVoice"},{"type":"text","text":" - file path e.g.: "},{"type":"codeVoice","code":"logs\/vernissage.log"},{"type":"text","text":"."}],"type":"paragraph"}]}]},{"inlineContent":[{"text":"We can also set the default login level by setting a system environment variable:","type":"text"}],"type":"paragraph"},{"type":"unorderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"LOG_LEVEL"},{"text":" - more information about log levels you can find ","type":"text"},{"type":"reference","identifier":"https:\/\/docs.vapor.codes\/basics\/logging\/","isActive":true},{"text":".","type":"text"}]}]}]},{"text":"Sentry","type":"heading","level":2,"anchor":"Sentry"},{"inlineContent":[{"type":"text","text":"It is possible to send application errors to the Sentry central logging system. To do this, set appropriate environment variables:"}],"type":"paragraph"},{"items":[{"content":[{"type":"paragraph","inlineContent":[{"code":"SENTRY_DSN","type":"codeVoice"},{"text":" - for writing Vernissage Server (API) logs","type":"text"}]}]},{"content":[{"inlineContent":[{"code":"SENTRY_DSN_WEB","type":"codeVoice"},{"text":" - for writing Vernissage Web logs","type":"text"}],"type":"paragraph"}]}],"type":"unorderedList"},{"level":2,"type":"heading","anchor":"Docker","text":"Docker"},{"inlineContent":[{"type":"text","text":"In production environments, it is best to use a "},{"type":"reference","isActive":true,"identifier":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server"},{"type":"text","text":"."}],"type":"paragraph"}],"kind":"content"}],"metadata":{"title":"Host Vernissage Server (API)","images":[{"type":"card","identifier":"host-server-card.jpg"}],"roleHeading":"Article","modules":[{"name":"VernissageServer"}],"role":"article"},"references":{"https://vapor.codes":{"identifier":"https:\/\/vapor.codes","type":"link","url":"https:\/\/vapor.codes","title":"Vapor","titleInlineContent":[{"type":"text","text":"Vapor"}]},"https://min.io":{"titleInlineContent":[{"type":"text","text":"minio"}],"url":"https:\/\/min.io","title":"minio","identifier":"https:\/\/min.io","type":"link"},"https://hub.docker.com/r/minio/minio":{"identifier":"https:\/\/hub.docker.com\/r\/minio\/minio","type":"link","url":"https:\/\/hub.docker.com\/r\/minio\/minio","title":"https:\/\/hub.docker.com\/r\/minio\/minio","titleInlineContent":[{"type":"text","text":"https:\/\/hub.docker.com\/r\/minio\/minio"}]},"https://hub.docker.com/repository/docker/mczachurski/vernissage-server":{"titleInlineContent":[{"text":"docker image","type":"text"}],"url":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server","identifier":"https:\/\/hub.docker.com\/repository\/docker\/mczachurski\/vernissage-server","title":"docker image","type":"link"},"https://www.swift.org/install/":{"identifier":"https:\/\/www.swift.org\/install\/","type":"link","url":"https:\/\/www.swift.org\/install\/","title":"Swift","titleInlineContent":[{"type":"text","text":"Swift"}]},"doc://VernissageServer/documentation/VernissageServer/BuildDocumentation":{"type":"topic","kind":"article","abstract":[{"type":"text","text":"This documentation is created by DocC tool."}],"url":"\/documentation\/vernissageserver\/builddocumentation","identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/BuildDocumentation","title":"Build the documentation","role":"article"},"https://www.swift.org/":{"identifier":"https:\/\/www.swift.org\/","type":"link","url":"https:\/\/www.swift.org\/","title":"Swift","titleInlineContent":[{"text":"Swift","type":"text"}]},"host-server-card.jpg":{"type":"image","alt":null,"identifier":"host-server-card.jpg","variants":[{"url":"\/images\/host-server-card@2x.jpg","traits":["2x","light"]}]},"https://docs.vapor.codes/basics/logging/":{"identifier":"https:\/\/docs.vapor.codes\/basics\/logging\/","type":"link","url":"https:\/\/docs.vapor.codes\/basics\/logging\/","title":"here","titleInlineContent":[{"type":"text","text":"here"}]},"host-web-card.jpg":{"type":"image","identifier":"host-web-card.jpg","alt":"The profile image for web documentation.","variants":[{"traits":["2x","light"],"url":"\/images\/host-web-card@2x.jpg"}]},"doc://VernissageServer/documentation/VernissageServer":{"identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer","kind":"symbol","type":"topic","abstract":[{"type":"text","text":"Application which is main API component for Vernissage photos sharing platform."}],"url":"\/documentation\/vernissageserver","role":"collection","title":"VernissageServer"},"doc://VernissageServer/documentation/VernissageServer/HostVernissageWeb":{"type":"topic","kind":"article","abstract":[{"text":"Application which is Web component for Vernissage photos sharing platform.","type":"text"}],"url":"\/documentation\/vernissageserver\/hostvernissageweb","identifier":"doc:\/\/VernissageServer\/documentation\/VernissageServer\/HostVernissageWeb","images":[{"type":"card","identifier":"host-web-card.jpg"}],"title":"Host Vernissage WEB","role":"article"}}}